\ProvidesPackage{beamerthemeHUST}
% ==============================
% Package Options Configuration
% ==============================
% This section defines the package options with their default values:
% - background: Logo variant to use (default: 01)
% - theme: Color theme (default: Red)
% - aspectratio: Slide aspect ratio (default: 169 for 16:9)
\SetupKeyvalOptions{
  family=template,
  prefix=template@
}
\DeclareStringOption[01]{background}
\DeclareStringOption[Red]{theme}
\DeclareStringOption[169]{aspectratio}
\ProcessKeyvalOptions*

\useinnertheme[shadow=true]{rounded}
% \useoutertheme{infolines}
% \usecolortheme{beaver}

% ==============================
% Logo Configuration
% ==============================
% This section configures the HUST logo variants and their sizing behavior.
% Each logo can be sized either by height or width, controlled by \ifhustbyheight.
% Default configuration uses logo16.pdf (HUST without text) with width-based scaling.

\newif\ifhustbyheight
\def\slidebackground{assets/logo/16.pdf}
\hustbyheightfalse

% Logo variant configurations
% Each section defines:
% 1. Path to logo file
% 2. Original dimensions in pixels
% 3. Scaling method (height/width based)

\ifdefstring{\template@background}{logo}{
  \def\slidebackground{assets/logo/01.pdf}
  \newcommand{\logoWpx}{2363} % Original width (px)
  \newcommand{\logoHpx}{3544} % Original height (px)
  \hustbyheighttrue        % Scale by height
}{}

\ifdefstring{\template@background}{logowithtext}{
  \def\slidebackground{assets/logo/02.pdf}
  \newcommand{\logoWpx}{7800} % Original width (px)
  \newcommand{\logoHpx}{1182} % Original height (px)
  \hustbyheighttrue        % Scale by height
}{}

\ifdefstring{\template@background}{logowithtextvi}{
  \def\slidebackground{assets/logo/03.pdf}
  \newcommand{\logoWpx}{4230} % Original width (px)
  \newcommand{\logoHpx}{1182} % Original height (px)
  \hustbyheighttrue        % Scale by height
}{}

\ifdefstring{\template@background}{logowithtexten}{
  \def\slidebackground{assets/logo/06.pdf}
  \newcommand{\logoWpx}{4866} % Original width (px)
  \newcommand{\logoHpx}{1182} % Original height (px)
  \hustbyheighttrue        % Scale by height
}{}

\ifdefstring{\template@background}{hustwithtext}{
  \def\slidebackground{assets/logo/12.pdf}
  \newcommand{\logoWpx}{5906} % Original width (px)
  \newcommand{\logoHpx}{2302} % Original height (px)
  \hustbyheightfalse       % Scale by width
}{}

\ifdefstring{\template@background}{hustwithtexten}{
  \def\slidebackground{assets/logo/14.pdf}
  \newcommand{\logoWpx}{5906} % Original width (px)
  \newcommand{\logoHpx}{2302} % Height adjusted to match hustwithtext ratio
  \hustbyheightfalse       % Scale by width
}{}

\ifdefstring{\template@background}{hustwithtextenlong}{
  \def\slidebackground{assets/logo/15.pdf}
  \newcommand{\logoWpx}{5906} % Width adjusted to match hustwithtext ratio
  \newcommand{\logoHpx}{1069} % Original height (px)
  \hustbyheightfalse       % Scale by width
}{}

\ifdefstring{\template@background}{hust}{
  \def\slidebackground{assets/logo/16.pdf}
  \newcommand{\logoWpx}{5907} % Original width (px)
  \newcommand{\logoHpx}{2302} % Height adjusted to match hustwithtext ratio
  \hustbyheightfalse       % Scale by width
}{}


\definecolor{darkred}{rgb}{0.8,0,0}

\setbeamercolor{section in toc}{fg=black,bg=white}
\setbeamercolor{alerted text}{fg=darkred!80!gray}
\setbeamercolor*{palette primary}{fg=darkred!60!black,bg=gray!30!white}
\setbeamercolor*{palette secondary}{fg=darkred!70!black,bg=gray!15!white}
\setbeamercolor*{palette tertiary}{bg=darkred!80!black,fg=gray!10!white}
\setbeamercolor*{palette quaternary}{fg=darkred,bg=gray!5!white}

\setbeamercolor*{sidebar}{fg=darkred,bg=gray!15!white}

\setbeamercolor*{palette sidebar primary}{fg=darkred!10!black}
\setbeamercolor*{palette sidebar secondary}{fg=white}
\setbeamercolor*{palette sidebar tertiary}{fg=darkred!50!black}
\setbeamercolor*{palette sidebar quaternary}{fg=gray!10!white}

%\setbeamercolor*{titlelike}{parent=palette primary}
\setbeamercolor{titlelike}{parent=palette primary,fg=darkred}

% --- HUST brand colors ---
\definecolor{HUSTNavy}{RGB}{0,51,102}
\definecolor{HUSTRed}{RGB}{192,32,52}
\definecolor{HUSTBlack}{RGB}{0,0,0}

\setbeamercolor{frametitle}{bg=HUSTNavy,fg=white}
\setbeamercolor{frametitle right}{bg=gray!60!white}

\makeatletter
\setbeamertemplate{frametitle}{%
  \nointerlineskip%
  \begin{beamercolorbox}[
      wd=\paperwidth,
      ht=0.065\paperheight,      % <-- vertical height above baseline
      dp=0.030\paperheight,      % <-- vertical depth below baseline
      leftskip=0.020\paperwidth,  % <-- left padding
      rightskip=0.020\paperwidth  % <-- right padding (only used if you add stuff on the right)
    ]{frametitle}%
    \usebeamerfont{frametitle}%
    \strut\insertframetitle\strut%
  \end{beamercolorbox}%
}
\makeatother

\setbeamercolor*{separation line}{}
\setbeamercolor*{fine separation line}{}

% --- Bottom footer + top bars (TikZ background canvas) ---
\RequirePackage{tikz}
\usetikzlibrary{calc}

\setbeamertemplate{background canvas}{%
  \begin{tikzpicture}[remember picture,overlay]

    \fill[HUSTRed]
      ($(current page.north west)+(0,-0.110\paperheight)$) rectangle
      ($(current page.north east)+(0,-0.118\paperheight)$);

  % ----------------------------------------
  % Footer Bar Dimensions (all values as fractions)
  % ----------------------------------------
  \pgfmathsetmacro{\barThickness}{0.003}    % Thickness of the red bar
  \pgfmathsetmacro{\verticalOffset}{0.035}  % Vertical shift for entire footer
  \pgfmathsetmacro{\horizontalOffset}{0.017} % Left margin for logo
  \pgfmathsetmacro{\barLeftGap}{0.017}      % Space between logo and bar (1%)
  \pgfmathsetmacro{\barRightGap}{0.020}     % Right margin for bar (2%)

  % ----------------------------------------
  % Logo Size Calculation
  % ----------------------------------------
  \pgfmathsetmacro{\desiredHeightFraction}{0.069} % Target logo height (6.9%)
  \pgfmathsetmacro{\logoAspect}{\logoWpx/\logoHpx} % Aspect ratio from pixels
  \pgfmathsetmacro{\logoWidthFraction}{\desiredHeightFraction*\logoAspect*(\paperheight/\paperwidth)}

  % ----------------------------------------
  % Bar Vertical Positioning
  % ----------------------------------------
  \pgfmathsetmacro{\barYmid}{\desiredHeightFraction/2 + \verticalOffset}
  \pgfmathsetmacro{\barYtop}{\barYmid + \barThickness/2}
  \pgfmathsetmacro{\barYbot}{\barYmid - \barThickness/2}

  % ----------------------------------------
  % Logo Placement
  % ----------------------------------------
  % Calculate logo position and right edge for bar alignment
  \pgfmathsetmacro{\logoXcenter}{\horizontalOffset + 0.5*\logoWidthFraction}
  \pgfmathsetmacro{\logoRightEdge}{\logoXcenter + 0.5*\logoWidthFraction}

  % Place logo with appropriate scaling method
  \node[anchor=center, inner sep=0pt, outer sep=0pt] (hustlogo)
    at ($(current page.south west)+(\logoXcenter*\paperwidth,\barYmid*\paperheight)$) {%
      \ifhustbyheight
        \includegraphics[height=\desiredHeightFraction\paperheight,keepaspectratio]{\slidebackground}%
      \else
        \includegraphics[width=\logoWidthFraction\paperwidth,keepaspectratio]{\slidebackground}%
      \fi
  };

  % ----------------------------------------
  % Red Bar Placement
  % ----------------------------------------
  % Draw bar from logo's right edge to page edge with specified gaps
  \fill[HUSTRed]
    ($(current page.south west)+(\logoRightEdge*\paperwidth+\barLeftGap*\paperwidth,\barYtop*\paperheight)$) rectangle
    ($(current page.south east)+(-\barRightGap*\paperwidth,\barYbot*\paperheight)$);

  \end{tikzpicture}%
}



\setbeamerfont{block title}{size={}}
\setbeamercolor{titlelike}{parent=structure,bg=white}
